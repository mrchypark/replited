# Release v0.3.4 Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Cut `v0.3.4` release by bumping `Cargo.toml` version, updating changelog + release notes, and re-running full verification before pushing to `main` (tag/release handled by CI on version change).

**Architecture:** No runtime behavior changes. This is a release-prep change set: metadata and documentation updates only, verified by running the full local test and E2E suites.

**Tech Stack:** Rust (`cargo`), Python E2E scripts (venv), GitHub Actions tag+release workflows.

---

### Task 1: Bump Version

**Files:**
- Modify: `Cargo.toml`

**Step 1: Write the expected version change**

Update:
- `version = "0.3.3"` -> `version = "0.3.4"`

**Step 2: Verify diff**

Run: `rg -n '^version\\s*=\\s*"' Cargo.toml`
Expected: first match shows `0.3.4`.

### Task 2: Update Changelog

**Files:**
- Modify: `CHANGELOG.md`

**Step 1: Add a new top entry**

Add `## [v0.3.4] - 2026-02-09` above `v0.3.3` with bullets for:
- restore outputs as `DB + WAL + SHM` set (non-follow restore moves `-wal/-shm`; ensure empty `-shm` when WAL exists)
- replica sidecar WAL apply: treat "offset beyond EOF" as invalid/rewindable
- E2E/battle harness reliability fixes (cleanup + convergence wait)

**Step 2: Sanity check formatting**

Run: `rg -n '^## \\[v0\\.3\\.4\\]' CHANGELOG.md`
Expected: exactly one match.

### Task 3: Add Release Notes

**Files:**
- Create: `RELEASE_NOTES_v0.3.4.md`

**Step 1: Mirror prior release notes style**

Include:
- Release date: `2026-02-09`
- Highlights + What's Changed (Restore semantics, Sidecar robustness, Test harness)
- Benchmark snapshot section: re-run benchmarks and paste a compact median/p95/p99 summary.
- Verification section: list exact commands used.

### Task 4: Run Verification (Full)

**Files:**
- None

**Step 1: Rust**

Run:
- `cargo fmt --check`
- `cargo clippy --all-targets --all-features -- -D warnings`
- `cargo test -q`

Expected: all succeed (exit code 0).

**Step 2: E2E/Battle**

Run (using venv python if present):
- `PATH="$(pwd)/.venv/bin:$PATH" bash tests/battle/run_battle_tests.sh --full`
- `PATH="$(pwd)/.venv/bin:$PATH" bash tests/benchmarks/run_all_benchmarks.sh`

Expected: scripts exit 0.

### Task 5: Commit Release Prep

**Files:**
- `Cargo.toml`
- `CHANGELOG.md`
- `RELEASE_NOTES_v0.3.4.md`
- `docs/plans/2026-02-09-release-v0.3.4.md`

**Step 1: Commit**

Run:
- `git add -A`
- `git commit -m "chore: release v0.3.4"`

### Task 6: Integrate To main + Push

**Files:**
- None

**Step 1: Fast-forward merge to main**

Run (from main worktree):
- `git merge --ff-only codex/release-v0.3.4`

**Step 2: Push**

Run:
- `git push origin main`

Expected: GitHub Actions `Tag on Version Change` creates tag `v0.3.4` and triggers `Release`.

