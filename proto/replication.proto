syntax = "proto3";

package replication;

service Replication {
  rpc StreamWal(Handshake) returns (stream WalPacket);
  rpc GetRestoreConfig(RestoreRequest) returns (RestoreConfig);
}

message RestoreRequest {
  string db_name = 1;
}

message RestoreConfig {
  string config_json = 1;
}

message WalPacket {
  oneof payload {
    bytes frame_data = 1;
    Checkpoint event = 2;
  }
}

message Handshake {
  string db_name = 1;
  string generation = 2;
  uint64 offset = 3;
  uint64 index = 4;
}



message Checkpoint {
  uint32 index = 1;
}

message Ack {
  bool success = 1;
}
